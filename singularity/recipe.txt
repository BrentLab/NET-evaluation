Bootstrap: docker
From: ubuntu:18.04

%help
    Image for running NET-evaluation package
    Brent Lab, Washington University in Saint Louis

%post
    # update OS
    apt-get update
    apt-get upgrade -y
    apt-get install -y tzdata
    
    # python
    apt-get install python3.6 -y
    apt install python3-pip -y
    pip3 install pandas

    # webgestalt
    apt-get install libcurl4-openssl-dev -y
    apt-get install libssl-dev -y
    apt-get install cmake libfreetype6-dev libfontconfig1-dev xclip -y
    apt-get install libcairo2-dev libjpeg-dev libgif-dev -y
    apt-get install r-base -y
    R --slave -e 'install.packages("WebGestaltR")'
    R --slave -e 'install.packages("rjson")'
    R --slave -e 'install.packages("optparse")'

    # perl, first install WebGestaltR coz there are packages
    # that perl depends on them for installing GO Term finder
    apt-get install perl-base
    apt-get upgrade perl -y
    
    # GO-TermFinder
    cd /home/packages/
    tar -xf GO-TermFinder-0.86.tar
    cd GO-TermFinder-0.86
    perl Makefile.PL
    make
    make install
    
%files
    ../../NET-evaluation /home/
    ../toy_example /home/
    ../packages /home/

# to build singularity container
# sudo singularity build --sandbox s_neteval recipe.txt
# ========================================================= #
# |   *** move container from one place to another ***    | #
# |               *** such with scp -r ***                | #
# ========================================================= #
# compress it, and then it can be transferred as its size is smaller 
# sudo tar --hard-dereference -czf s_np.tar.gz s_np
# decompree it
# tar -xf s_np.tar.gz
# ========================================================= #
# |   *** push container to cloud, then it can be  ***    | #
# |             *** loaded from sylabs ***                | #
# ========================================================= #
# 1. create an account with sylabs, 2. an access token, then 3. push it to clould
# Refer to this page to create an account and access token: https://sylabs.io/guides/3.3/user-guide/cloud_library.html
# To be able to push the container to clould, first it needs to be packaged in sif file
# sudo singularity build s_neteval.sif recipe.txt
# singularity remote login SylabsClould
# singularity push -U s_neteval.sif library://dabid/default/s_neteval
# to get back the original folder (not a sif version of it)
# sudo singularity build --sandbox s_neteval s_neteval.sif
# note that I wasn't able to create a .sif file directly. I had
# create the container first, and then build it into .sif file
